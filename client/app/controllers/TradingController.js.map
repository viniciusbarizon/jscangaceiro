{"version":3,"sources":["../../app-src/controllers/TradingController.js"],"names":["Tradings","TradingService","Trading","TradingsView","MessageView","Message","DateConverter","getTradingDao","Bind","getExceptionMessage","debounce","controller","TradingController","constructor","_inputDate","_inputQuantity","_inputValue","Object","assign","_tradings","_message","_service","_init","dao","tradings","listAll","forEach","add","trading","err","text","event","preventDefault","_create","_cleanForm","value","focus","toDate","parseInt","parseFloat","clear","clearAll","importTradings","getTradingsFromThePeriod","then","filter","toArray","some","newTrading","equals","existingTrading","catch"],"mappings":"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","file":"TradingController.js","sourcesContent":["import { Tradings, TradingService, Trading } from '../domain/index.js';\nimport { TradingsView, MessageView, Message, DateConverter } from '../ui/index.js';\n\n// importing the decorator.\nimport { getTradingDao, Bind, getExceptionMessage, debounce, controller } from '../util/index.js';\n\n@controller( '#date', '#quantity', '#value' )\nexport class TradingController {\n    constructor( _inputDate, _inputQuantity, _inputValue ) {\n        Object.assign(this, { _inputDate, _inputQuantity, _inputValue } )\n\n        this._tradings = new Bind(\n            new Tradings(),\n            new TradingsView('#tradings'),\n            'add', 'clear'\n        );\n\n        this._message = new Bind(\n            new Message(),\n            new MessageView('#messageView'),\n            'text'\n        );\n\n        this._service = new TradingService();\n\n        // call the method for initialization.\n        this._init();\n    }\n\n    async _init() {\n        try {\n            const dao = await getTradingDao();\n            const tradings = await dao.listAll();\n            tradings.forEach(trading => this._tradings.add(trading));\n        }\n        catch(err) {\n            // err.message extracts only the exception error message.\n            this._message.text = getExceptionMessage(err);\n        }\n    }\n\n    @debounce()\n    async add( event ) {\n        try {\n            event.preventDefault();\n\n            // trading that we need to include in the Database and in the HTML table.\n            const trading = this._create();\n\n            const dao = await getTradingDao();\n            await dao.add(trading);\n\n            // will try to add in the HTML Table only if it was inserted in the Database.\n            this._tradings.add(trading);\n            this._message.text = 'Trading has been added successfully';\n\n            this._cleanForm();\n        }\n        catch(err) {\n            this._message.text = getExceptionMessage(err);\n        }\n    }\n\n    _cleanForm() {\n        this._inputDate.value = '';\n        this._inputQuantity.value = 1;\n        this._inputValue.value = 0.0;\n\n        this._inputDate.focus();\n    }\n\n    _create() {\n        // returns a new Trading instance.\n        return new Trading(\n            DateConverter.toDate(this._inputDate.value),\n            parseInt(this._inputQuantity.value),\n            parseFloat(this._inputValue.value)\n        );\n    }\n\n    async clear() {\n        try {\n            const dao = await getTradingDao();\n            await dao.clearAll();\n\n            this._tradings.clear();\n            this._message.text = 'Tradings have been cleared successfully.';\n        }\n        catch(err) {\n            this._message.text = getExceptionMessage(err);\n        }\n    }\n\n    @debounce(1500)\n    async importTradings() {\n        this._service\n            .getTradingsFromThePeriod()\n            .then(tradings => {\n                tradings\n                    .filter(newTrading => !this._tradings.toArray().some(existingTrading =>\n                        newTrading.equals(existingTrading)\n                    ))\n                    .forEach(trading => this._tradings.add(trading))\n                this._message.text = 'Tradings have been imported successfully';\n            })\n            .catch(err => this._message.text = err);\n    }\n}"]}