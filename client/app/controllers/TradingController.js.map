{"version":3,"sources":["../../app-src/controllers/TradingController.js"],"names":["Tradings","TradingService","Trading","TradingsView","MessageView","Message","DateInvalidException","DateConverter","getTradingDao","Bind","TradingController","constructor","$","document","querySelector","bind","_inputDate","_inputQuantity","_inputValue","_tradings","_message","_service","_init","dao","tradings","listAll","forEach","trading","add","err","text","message","event","preventDefault","_create","_cleanForm","value","focus","toDate","parseInt","parseFloat","clear","clearAll","importTradings","getTradingsFromThePeriod","then","filter","newTrading","toArray","some","existingTrading","equals","catch"],"mappings":"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","file":"TradingController.js","sourcesContent":["import { Tradings, TradingService, Trading } from '../domain/index.js';\nimport { TradingsView, MessageView, Message, DateInvalidException, DateConverter } from '../ui/index.js';\nimport { getTradingDao, Bind } from '../util/index.js';\n\nexport class TradingController {\n    constructor() {\n        // doing the bind, $ keep document as his context.\n        const $ = document.querySelector.bind(document);\n\n        this._inputDate = $('#date');\n        this._inputQuantity = $('#quantity');\n        this._inputValue = $('#value');\n\n        this._tradings = new Bind(\n            new Tradings(),\n            new TradingsView('#tradings'),\n            'add', 'clear'\n        );\n\n        this._message = new Bind(\n            new Message(),\n            new MessageView('#messageView'),\n            'text'\n        );\n\n        this._service = new TradingService();\n\n        // call the method for initialization.\n        this._init();\n    }\n\n    async _init() {\n        try {\n            const dao = await getTradingDao();\n            const tradings = await dao.listAll();\n            tradings.forEach(trading => this._tradings.add(trading));\n        }\n        catch(err) {\n            // err.message extracts only the exception error message.\n            this._message.text = err.message;\n        }\n    }\n\n    async add( event ) {\n        try {\n            event.preventDefault();\n\n            // trading that we need to include in the Database and in the HTML table.\n            const trading = this._create();\n\n            const dao = await getTradingDao();\n            await dao.add(trading);\n\n            // will try to add in the HTML Table only if it was inserted in the Database.\n            this._tradings.add(trading);\n            this._message.text = 'Trading has been added successfully';\n\n            this._cleanForm();\n        }\n        catch(err) {\n            this._message.text = err.message;\n        }\n    }\n\n    _cleanForm() {\n        this._inputDate.value = '';\n        this._inputQuantity.value = 1;\n        this._inputValue.value = 0.0;\n\n        this._inputDate.focus();\n    }\n\n    _create() {\n        // returns a new Trading instance.\n        return new Trading(\n            DateConverter.toDate(this._inputDate.value),\n            parseInt(this._inputQuantity.value),\n            parseFloat(this._inputValue.value)\n        );\n    }\n\n    async clear() {\n        try {\n            const dao = await getTradingDao();\n            await dao.clearAll();\n\n            this._tradings.clear();\n            this._message.text = 'Tradings have been cleared successfully.';\n        }\n        catch(err) {\n            this._message.text = err.message;\n        }\n    }\n\n    importTradings() {\n        this._service\n            .getTradingsFromThePeriod()\n            .then(tradings => {\n                tradings\n                    .filter(newTrading => !this._tradings.toArray().some(existingTrading =>\n                        newTrading.equals(existingTrading)\n                    ))\n                    .forEach(trading => this._tradings.add(trading))\n                this._message.text = 'Tradings have been imported successfully';\n            })\n            .catch(err => this._message.text = err);\n    }\n}"]}